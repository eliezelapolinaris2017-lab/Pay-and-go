<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nexus POS</title>

  <link rel="stylesheet" href="styles.css" />

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">
  <link rel="apple-touch-icon" href="assets/pwa/icon-192.png">

  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <!-- Firebase (Firestore) compat -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>

<body>
  <!-- Historial flotante -->
  <button class="fabHistory" id="btnHistory" type="button">Historial</button>

  <main class="wrap">
    <!-- ===== PANTALLA 1: MÉTODOS ===== -->
    <section id="screenMethods" class="screen">
      <div class="screenHead">
        <h1>Select Payment Method</h1>
        <p>Selecciona el método. Después registras el cliente y cobras.</p>
      </div>

      <div id="methodsGrid" class="gridFull"></div>
    </section>

    <!-- ===== PANTALLA 2: REGISTRO ===== -->
    <section id="screenRegister" class="screen hidden">
      <div class="screenHead split">
        <div>
          <h1>Registro</h1>
          <p>Guardar → Ir a pagar → Pago completado (manual) → Ticket PDF.</p>
        </div>
        <div>
          <button class="btn btnGhost" id="btnBack" type="button">← Volver</button>
        </div>
      </div>

      <div class="card">
        <div class="methodBadge" id="methodBadge">Método</div>

        <form id="payForm" class="form">
          <div class="field">
            <label>Nombre *</label>
            <input id="fName" required placeholder="Nombre y apellido" autocomplete="name">
          </div>

          <div class="field">
            <label>Teléfono</label>
            <input id="fPhone" placeholder="787-000-0000" inputmode="tel">
          </div>

          <div class="field">
            <label>Monto *</label>
            <input id="fAmount" required placeholder="75.00" inputmode="decimal">
          </div>

          <div class="field">
            <label>Referencia / Factura</label>
            <input id="fInvoice" placeholder="Opcional">
          </div>

          <div class="field fieldWide">
            <label>Nota</label>
            <input id="fNote" placeholder="Ej: mantenimiento profundo">
          </div>

          <div class="field fieldWide">
            <div class="btnRow">
              <button class="btn btnPrimary" id="btnSave" type="submit">Guardar</button>
              <button class="btn" id="btnGoPay" type="button">Ir a pagar</button>
              <button class="btn btnOk" id="btnPaid" type="button">Pago completado (manual)</button>
            </div>
            <div class="hint" id="statusHint">Listo.</div>
          </div>
        </form>
      </div>
    </section>
  </main>

  <!-- ===== MODAL: QR / LINK ===== -->
  <div class="modal hidden" id="qrModal" role="dialog" aria-modal="true">
    <div class="modalCard">
      <div class="modalHead">
        <div>
          <h2 id="qrTitle">Escanea para pagar</h2>
          <p id="qrSub">Usa la cámara del teléfono y completa el pago.</p>
        </div>
        <button class="btn btnGhost" id="btnCloseQR" type="button">Cerrar</button>
      </div>
      <div class="qrBody">
        <img id="qrImg" alt="QR de pago">
      </div>
      <div class="qrFoot" id="qrFoot"></div>
    </div>
  </div>

  <!-- ===== MODAL: HISTORIAL ===== -->
  <div class="modal hidden" id="histModal" role="dialog" aria-modal="true">
    <div class="modalCard">
      <div class="modalHead">
        <div>
          <h2>Historial (Nube + Local)</h2>
          <p>Si estás offline, verás local; cuando vuelva internet, sincroniza.</p>
        </div>
        <button class="btn btnGhost" id="btnCloseHist" type="button">Cerrar</button>
      </div>

      <div class="modalActions">
        <button class="btn" id="btnSync" type="button">Sincronizar ahora</button>
        <button class="btn" id="btnExportCSV" type="button">Export CSV</button>
        <button class="btn" id="btnExportJSON" type="button">Export JSON</button>
        <button class="btn btnDanger" id="btnClearLocal" type="button">Borrar Local</button>
      </div>

      <div class="tableWrap">
        <table class="table" id="histTable">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Método</th>
              <th>Cliente</th>
              <th>Tel</th>
              <th>Nota</th>
              <th class="r">Monto</th>
              <th>Estado</th>
              <th>ID</th>
            </tr>
          </thead>
          <tbody id="histBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Footer SOLO texto -->
  <footer class="posFooter" aria-hidden="true">
    <div class="posFooterInner">
      <div class="posFooterSub">PAYMENT PLATFORM</div>
    </div>
  </footer>

  <script src="app.js"></script>

  <!-- Service Worker -->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./service-worker.js");
    }
  </script>
</body>
</html>
